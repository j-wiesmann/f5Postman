{
	"info": {
		"name": "LTM-Policy_Pool_per_Domain_Name",
		"_postman_id": "731f576a-a90b-8cc4-5786-cf05fefbea11",
		"description": "This is an example, how a LTM-Policy can be created and configured over iControl REST API. The idea behind this example is, to create a virtual server and assign a new created policy to it.",
		"schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
	},
	"item": [
		{
			"name": "Create Basic Configuration",
			"description": "Here we create the policy and the virtual we use for the demo. Since it is not allowed to assign an empty policy to a virtual, we also create an initial pool for an initial domain name.",
			"item": [
				{
					"name": "Get Authentication Token on bigip",
					"event": [
						{
							"listen": "test",
							"script": {
								"type": "text/javascript",
								"exec": [
									"//////////////////////////////////////",
									"// Set Token",
									"",
									"var resp = JSON.parse(responseBody);",
									"postman.setGlobalVariable(\"X-F5-Auth-Token\", resp.token.token);"
								]
							}
						}
					],
					"request": {
						"auth": {
							"type": "basic",
							"basic": [
								{
									"key": "username",
									"value": "admin",
									"type": "string"
								},
								{
									"key": "password",
									"value": "admin",
									"type": "string"
								},
								{
									"key": "saveHelperData",
									"value": true,
									"type": "boolean"
								},
								{
									"key": "showPassword",
									"value": false,
									"type": "boolean"
								}
							]
						},
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							},
							{
								"key": "Authorization",
								"value": "Basic YWRtaW46YWRtaW4="
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n    \"username\":\"{{BIG-IP_username}}\",\n    \"password\":\"{{BIG-IP_password}}\",\n    \"loginProviderName\": \"tmos\"\n}"
						},
						"url": {
							"raw": "https://{{big_ip_a_mgmt}}/mgmt/shared/authn/login",
							"protocol": "https",
							"host": [
								"{{big_ip_a_mgmt}}"
							],
							"path": [
								"mgmt",
								"shared",
								"authn",
								"login"
							]
						},
						"description": ""
					},
					"response": []
				},
				{
					"name": "Create LTM Policy",
					"event": [
						{
							"listen": "prerequest",
							"script": {
								"type": "text/javascript",
								"exec": [
									"",
									""
								]
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							},
							{
								"key": "X-F5-Auth-Token",
								"value": "{{X-F5-Auth-Token}}"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n    \"name\": \"/{{partition}}/Drafts/{{name}}_policy\",\n    \"description\": \"Autogenerated over REST\",\n    \"partition\": \"{{partition}}\",\n    \"subPath\": \"Drafts\",\n    \"strategy\": \"/Common/first-match\"\n}"
						},
						"url": {
							"raw": "https://{{big_ip_a_mgmt}}/mgmt/tm/ltm/policy",
							"protocol": "https",
							"host": [
								"{{big_ip_a_mgmt}}"
							],
							"path": [
								"mgmt",
								"tm",
								"ltm",
								"policy"
							]
						},
						"description": ""
					},
					"response": []
				},
				{
					"name": "Create Pool",
					"event": [
						{
							"listen": "test",
							"script": {
								"type": "text/javascript",
								"exec": [
									"postman.setGlobalVariable(\"member_index\", 0);"
								]
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							},
							{
								"key": "X-F5-Auth-Token",
								"value": "{{X-F5-Auth-Token}}"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n    \"name\": \"{{name}}_{{basic_domain}}_pool\",\n    \"partition\": \"{{partition}}\",\n    \"allowNat\": \"yes\",\n    \"allowSnat\": \"yes\",\n    \"ignorePersistedWeight\": \"disabled\",\n    \"ipTosToClient\": \"pass-through\",\n    \"ipTosToServer\": \"pass-through\",\n    \"linkQosToClient\": \"pass-through\",\n    \"linkQosToServer\": \"pass-through\",\n    \"loadBalancingMode\": \"round-robin\",\n    \"minActiveMembers\": 0,\n    \"minUpMembers\": 0,\n    \"minUpMembersAction\": \"failover\",\n    \"minUpMembersChecking\": \"disabled\",\n    \"monitor\": \"/Common/http \",\n    \"queueDepthLimit\": 0,\n    \"queueOnConnectionLimit\": \"disabled\",\n    \"queueTimeLimit\": 0,\n    \"reselectTries\": 0,\n    \"serviceDownAction\": \"none\",\n    \"slowRampTime\": 10\n}"
						},
						"url": {
							"raw": "https://{{big_ip_a_mgmt}}/mgmt/tm/ltm/pool",
							"protocol": "https",
							"host": [
								"{{big_ip_a_mgmt}}"
							],
							"path": [
								"mgmt",
								"tm",
								"ltm",
								"pool"
							]
						},
						"description": ""
					},
					"response": []
				},
				{
					"name": "Add Pool Member",
					"event": [
						{
							"listen": "test",
							"script": {
								"type": "text/javascript",
								"exec": [
									"var i = postman.getGlobalVariable(\"member_index\");",
									"",
									"// get member list",
									"",
									"var member_str = postman.getEnvironmentVariable(\"basic_members\");",
									"var member_list = member_str.split(\",\");",
									"",
									"if ( member_list.length > i ) {",
									"    postman.setNextRequest(\"Add Pool Member\");",
									"}",
									""
								]
							}
						},
						{
							"listen": "prerequest",
							"script": {
								"type": "text/javascript",
								"exec": [
									"// Start Loop",
									"",
									"var i = postman.getGlobalVariable(\"member_index\");",
									"",
									"if ( typeof i == 'undefined') {",
									"    i = 0;",
									"}",
									"",
									"// get member list",
									"",
									"var member_str = postman.getEnvironmentVariable(\"basic_members\");",
									"var member_list = member_str.split(\",\");",
									"",
									"if ( member_list.length > i ) {",
									"    postman.setGlobalVariable(\"member\", member_list[i]);",
									"    var split = member_list[i].split(\":\");",
									"    postman.setGlobalVariable(\"address\", split[0]);",
									"}",
									"",
									"postman.setGlobalVariable(\"member_index\", ++i);",
									""
								]
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							},
							{
								"key": "X-F5-Auth-Token",
								"value": "{{X-F5-Auth-Token}}"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n    \"name\": \"{{member}}\",\n    \"partition\": \"{{partition}}\",\n    \"address\": \"{{address}}\",\n    \"connectionLimit\": 0,\n    \"dynamicRatio\": 1,\n    \"ephemeral\": \"false\",\n    \"inheritProfile\": \"enabled\",\n    \"logging\": \"disabled\",\n    \"monitor\": \"default\",\n    \"priorityGroup\": 0,\n    \"rateLimit\": \"disabled\",\n    \"ratio\": 1\n}"
						},
						"url": {
							"raw": "https://{{big_ip_a_mgmt}}/mgmt/tm/ltm/pool/~{{partition}}~{{name}}_{{basic_domain}}_pool/members",
							"protocol": "https",
							"host": [
								"{{big_ip_a_mgmt}}"
							],
							"path": [
								"mgmt",
								"tm",
								"ltm",
								"pool",
								"~{{partition}}~{{name}}_{{basic_domain}}_pool",
								"members"
							]
						},
						"description": ""
					},
					"response": []
				},
				{
					"name": "Create LTM Policy rule",
					"event": [
						{
							"listen": "prerequest",
							"script": {
								"type": "text/javascript",
								"exec": [
									"",
									""
								]
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							},
							{
								"key": "X-F5-Auth-Token",
								"value": "{{X-F5-Auth-Token}}"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n    \"name\": \"{{basic_domain}}\",\n    \"actionsReference\": {\n        \"isSubcollection\": true,\n        \"items\": [\n            {\n                \"name\": \"0\",\n                \"fullPath\": \"0\",\n                \"code\": 0,\n                \"expirySecs\": 0,\n                \"forward\": true,\n                \"length\": 0,\n                \"offset\": 0,\n                \"pool\": \"/{{partition}}/{{name}}_{{basic_domain}}_pool\",\n                \"poolReference\": {\n                    \"link\": \"https://localhost/mgmt/tm/ltm/pool/~{{partition}}~{{name}}_{{basic_domain}}_pool\"\n                },\n                \"port\": 0,\n                \"request\": true,\n                \"select\": true,\n                \"status\": 0,\n                \"timeout\": 0,\n                \"vlanId\": 0\n            }\n        ]\n    },\n    \"conditionsReference\": {\n        \"isSubcollection\": true,\n        \"items\": [\n            {\n                \"name\": \"0\",\n                \"fullPath\": \"0\",\n                \"all\": true,\n                \"caseInsensitive\": true,\n                \"equals\": true,\n                \"external\": true,\n                \"httpHeader\": true,\n                \"index\": 0,\n                \"tmName\": \"host\",\n                \"present\": true,\n                \"remote\": true,\n                \"request\": true,\n                \"values\": [\n                    \"{{basic_domain}}\"\n                ]\n            }\n        ]\n    }\n}"
						},
						"url": {
							"raw": "https://{{big_ip_a_mgmt}}/mgmt/tm/ltm/policy/~{{partition}}~Drafts~{{name}}_policy/rules",
							"protocol": "https",
							"host": [
								"{{big_ip_a_mgmt}}"
							],
							"path": [
								"mgmt",
								"tm",
								"ltm",
								"policy",
								"~{{partition}}~Drafts~{{name}}_policy",
								"rules"
							]
						},
						"description": ""
					},
					"response": []
				},
				{
					"name": "Publish LTM Policy",
					"event": [
						{
							"listen": "prerequest",
							"script": {
								"type": "text/javascript",
								"exec": [
									"",
									""
								]
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							},
							{
								"key": "X-F5-Auth-Token",
								"value": "{{X-F5-Auth-Token}}"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n    \"command\": \"publish\",\n    \"name\": \"/{{partition}}/Drafts/{{name}}_policy\"\n}"
						},
						"url": {
							"raw": "https://{{big_ip_a_mgmt}}/mgmt/tm/ltm/policy",
							"protocol": "https",
							"host": [
								"{{big_ip_a_mgmt}}"
							],
							"path": [
								"mgmt",
								"tm",
								"ltm",
								"policy"
							]
						},
						"description": ""
					},
					"response": []
				},
				{
					"name": "Create Virtual Server",
					"event": [
						{
							"listen": "prerequest",
							"script": {
								"type": "text/javascript",
								"exec": [
									"",
									""
								]
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							},
							{
								"key": "X-F5-Auth-Token",
								"value": "{{X-F5-Auth-Token}}"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n    \"name\": \"{{name}}_vs\",\n\t\"partition\": \"{{partition}}\",\n    \"addressStatus\": \"yes\",\n    \"autoLasthop\": \"default\",\n    \"cmpEnabled\": \"yes\",\n    \"connectionLimit\": 0,\n    \"destination\": \"/{{partition}}/{{destination}}\",\n    \"enabled\": true,\n    \"gtmScore\": 0,\n    \"ipProtocol\": \"tcp\",\n    \"mask\": \"255.255.255.255\",\n    \"mirror\": \"disabled\",\n    \"mobileAppTunnel\": \"disabled\",\n    \"nat64\": \"disabled\",\n    \"rateLimit\": \"disabled\",\n    \"rateLimitDstMask\": 0,\n    \"rateLimitMode\": \"object\",\n    \"rateLimitSrcMask\": 0,\n    \"securityNatPolicy\": {\n        \"useDevicePolicy\": \"no\",\n        \"useRouteDomainPolicy\": \"no\"\n    },\n    \"serviceDownImmediateAction\": \"none\",\n    \"source\": \"0.0.0.0/0\",\n    \"sourceAddressTranslation\": {\n        \"type\": \"automap\"\n    },\n    \"sourcePort\": \"preserve\",\n    \"synCookieStatus\": \"not-activated\",\n    \"translateAddress\": \"enabled\",\n    \"translatePort\": \"enabled\",\n    \"vlansDisabled\": true,\n    \"vsIndex\": 27,\n    \"policiesReference\": {\n        \"link\": \"https://localhost/mgmt/tm/ltm/virtual/~{{partition}}~{{name}}_vs/policies\",\n        \"isSubcollection\": true,\n        \"items\": [\n            {\n                \"name\": \"{{name}}_policy\",\n                \"partition\": \"{{partition}}\",\n                \"nameReference\": {\n                    \"link\": \"https://localhost/mgmt/tm/ltm/policy/~{{partition}}~{{name}}_policy\"\n                }\n            }\n        ]\n    },\n    \"profilesReference\": {\n        \"link\": \"https://localhost/mgmt/tm/ltm/virtual/~{{partition}}~{{name}}_vs/profiles?ver=12.1.1\",\n        \"isSubcollection\": true,\n        \"items\": [\n            {\n                \"name\": \"http\",\n                \"partition\": \"Common\",\n                \"fullPath\": \"/Common/http\",\n                \"context\": \"all\",\n                \"nameReference\": {\n                    \"link\": \"https://localhost/mgmt/tm/ltm/profile/http/~Common~http?ver=12.1.1\"\n                }\n            },\n            {\n                \"name\": \"tcp\",\n                \"partition\": \"Common\",\n                \"fullPath\": \"/Common/tcp\",\n                \"context\": \"all\",\n                \"nameReference\": {\n                    \"link\": \"https://localhost/mgmt/tm/ltm/profile/tcp/~Common~tcp?ver=12.1.1\"\n                }\n            }\n        ]\n    }\n}"
						},
						"url": {
							"raw": "https://{{big_ip_a_mgmt}}/mgmt/tm/ltm/virtual",
							"protocol": "https",
							"host": [
								"{{big_ip_a_mgmt}}"
							],
							"path": [
								"mgmt",
								"tm",
								"ltm",
								"virtual"
							]
						},
						"description": ""
					},
					"response": []
				}
			]
		},
		{
			"name": "Add Domain Names",
			"description": "Run this to create new pools per Domain Name and assign them to the created policy. This part can be rerun to add further Domain Names later.",
			"item": [
				{
					"name": "Get Authentication Token on bigip",
					"event": [
						{
							"listen": "test",
							"script": {
								"type": "text/javascript",
								"exec": [
									"//////////////////////////////////////",
									"// Set Token",
									"",
									"var resp = JSON.parse(responseBody);",
									"postman.setGlobalVariable(\"X-F5-Auth-Token\", resp.token.token);"
								]
							}
						}
					],
					"request": {
						"auth": {
							"type": "basic",
							"basic": [
								{
									"key": "username",
									"value": "admin",
									"type": "string"
								},
								{
									"key": "password",
									"value": "admin",
									"type": "string"
								},
								{
									"key": "saveHelperData",
									"value": true,
									"type": "boolean"
								},
								{
									"key": "showPassword",
									"value": false,
									"type": "boolean"
								}
							]
						},
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							},
							{
								"key": "Authorization",
								"value": "Basic YWRtaW46YWRtaW4="
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n    \"username\":\"{{BIG-IP_username}}\",\n    \"password\":\"{{BIG-IP_password}}\",\n    \"loginProviderName\": \"tmos\"\n}"
						},
						"url": {
							"raw": "https://{{big_ip_a_mgmt}}/mgmt/shared/authn/login",
							"protocol": "https",
							"host": [
								"{{big_ip_a_mgmt}}"
							],
							"path": [
								"mgmt",
								"shared",
								"authn",
								"login"
							]
						},
						"description": ""
					},
					"response": []
				},
				{
					"name": "Draft LTM Policy",
					"event": [
						{
							"listen": "test",
							"script": {
								"type": "text/javascript",
								"exec": [
									"postman.setGlobalVariable(\"domain_index\", 0);"
								]
							}
						},
						{
							"listen": "prerequest",
							"script": {
								"type": "text/javascript",
								"exec": [
									"",
									""
								]
							}
						}
					],
					"request": {
						"method": "PATCH",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							},
							{
								"key": "X-F5-Auth-Token",
								"value": "{{X-F5-Auth-Token}}"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n    \"partition\": \"{{partition}}\"\n}"
						},
						"url": {
							"raw": "https://{{big_ip_a_mgmt}}/mgmt/tm/ltm/policy/~{{partition}}~{{name}}_policy?options=create-draft",
							"protocol": "https",
							"host": [
								"{{big_ip_a_mgmt}}"
							],
							"path": [
								"mgmt",
								"tm",
								"ltm",
								"policy",
								"~{{partition}}~{{name}}_policy"
							],
							"query": [
								{
									"key": "options",
									"value": "create-draft",
									"equals": true
								}
							]
						},
						"description": ""
					},
					"response": []
				},
				{
					"name": "Create Pool",
					"event": [
						{
							"listen": "test",
							"script": {
								"type": "text/javascript",
								"exec": [
									"postman.setGlobalVariable(\"member_index\", 0);"
								]
							}
						},
						{
							"listen": "prerequest",
							"script": {
								"type": "text/javascript",
								"exec": [
									"// Start Loop",
									"",
									"var i = postman.getGlobalVariable(\"domain_index\");",
									"",
									"if ( typeof i == 'undefined') {",
									"    i = 0;",
									"}",
									"",
									"// get domain list",
									"",
									"var domain_list = postman.getEnvironmentVariable(\"domain_list\");",
									"",
									"if ( typeof domain_list == 'undefined') {",
									"    ",
									"    exit;",
									"}",
									"",
									"jdata = JSON.parse(domain_list);",
									"",
									"if ( jdata.length > i ) {",
									"    ",
									"    if ( typeof jdata[i].domain != 'undefined') {",
									"        postman.setGlobalVariable(\"domainname\", jdata[i].domain);",
									"    }",
									"     if ( typeof jdata[i].members != 'undefined') {",
									"        postman.setGlobalVariable(\"members\", jdata[i].members);",
									"    }",
									"}",
									"",
									"postman.setGlobalVariable(\"domain_index\", ++i);",
									"",
									""
								]
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							},
							{
								"key": "X-F5-Auth-Token",
								"value": "{{X-F5-Auth-Token}}"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n    \"name\": \"{{name}}_{{domainname}}_pool\",\n    \"partition\": \"{{partition}}\",\n    \"allowNat\": \"yes\",\n    \"allowSnat\": \"yes\",\n    \"ignorePersistedWeight\": \"disabled\",\n    \"ipTosToClient\": \"pass-through\",\n    \"ipTosToServer\": \"pass-through\",\n    \"linkQosToClient\": \"pass-through\",\n    \"linkQosToServer\": \"pass-through\",\n    \"loadBalancingMode\": \"round-robin\",\n    \"minActiveMembers\": 0,\n    \"minUpMembers\": 0,\n    \"minUpMembersAction\": \"failover\",\n    \"minUpMembersChecking\": \"disabled\",\n    \"monitor\": \"/Common/http and /Common/tcp \",\n    \"queueDepthLimit\": 0,\n    \"queueOnConnectionLimit\": \"disabled\",\n    \"queueTimeLimit\": 0,\n    \"reselectTries\": 0,\n    \"serviceDownAction\": \"none\",\n    \"slowRampTime\": 10\n}"
						},
						"url": {
							"raw": "https://{{big_ip_a_mgmt}}/mgmt/tm/ltm/pool",
							"protocol": "https",
							"host": [
								"{{big_ip_a_mgmt}}"
							],
							"path": [
								"mgmt",
								"tm",
								"ltm",
								"pool"
							]
						},
						"description": ""
					},
					"response": []
				},
				{
					"name": "Add Pool Member",
					"event": [
						{
							"listen": "test",
							"script": {
								"type": "text/javascript",
								"exec": [
									"var i = postman.getGlobalVariable(\"member_index\");",
									"",
									"// get domain list",
									"",
									"",
									"// get member list",
									"",
									"var member_str = postman.getGlobalVariable(\"members\");",
									"var member_list = member_str.split(\",\");",
									"",
									"if ( member_list.length > i ) {",
									"    postman.setNextRequest(\"Add Pool Member\");",
									"}",
									""
								]
							}
						},
						{
							"listen": "prerequest",
							"script": {
								"type": "text/javascript",
								"exec": [
									"// Start Loop",
									"",
									"var i = postman.getGlobalVariable(\"member_index\");",
									"",
									"if ( typeof i == 'undefined') {",
									"    i = 0;",
									"}",
									"",
									"// get member list",
									"",
									"var member_str = postman.getGlobalVariable(\"members\");",
									"var member_list = member_str.split(\",\");",
									"",
									"if ( member_list.length > i ) {",
									"    postman.setGlobalVariable(\"member\", member_list[i]);",
									"    var split = member_list[i].split(\":\");",
									"    postman.setGlobalVariable(\"address\", split[0]);",
									"}",
									"",
									"postman.setGlobalVariable(\"member_index\", ++i);",
									"",
									""
								]
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							},
							{
								"key": "X-F5-Auth-Token",
								"value": "{{X-F5-Auth-Token}}"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n    \"name\": \"{{member}}\",\n    \"partition\": \"{{partition}}\",\n    \"address\": \"{{address}}\",\n    \"connectionLimit\": 0,\n    \"dynamicRatio\": 1,\n    \"ephemeral\": \"false\",\n    \"inheritProfile\": \"enabled\",\n    \"logging\": \"disabled\",\n    \"monitor\": \"default\",\n    \"priorityGroup\": 0,\n    \"rateLimit\": \"disabled\",\n    \"ratio\": 1\n}"
						},
						"url": {
							"raw": "https://{{big_ip_a_mgmt}}/mgmt/tm/ltm/pool/~{{partition}}~{{name}}_{{domainname}}_pool/members",
							"protocol": "https",
							"host": [
								"{{big_ip_a_mgmt}}"
							],
							"path": [
								"mgmt",
								"tm",
								"ltm",
								"pool",
								"~{{partition}}~{{name}}_{{domainname}}_pool",
								"members"
							]
						},
						"description": ""
					},
					"response": []
				},
				{
					"name": "Create LTM Policy rule",
					"event": [
						{
							"listen": "test",
							"script": {
								"type": "text/javascript",
								"exec": [
									"var i = postman.getGlobalVariable(\"domain_index\");",
									"",
									"// get domain list",
									"",
									"var domain_list = postman.getEnvironmentVariable(\"domain_list\");",
									"jdata = JSON.parse(domain_list);",
									"",
									"if ( jdata.length > i ) {",
									"    postman.setNextRequest(\"Create Pool\");",
									"}",
									""
								]
							}
						},
						{
							"listen": "prerequest",
							"script": {
								"type": "text/javascript",
								"exec": [
									"",
									""
								]
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							},
							{
								"key": "X-F5-Auth-Token",
								"value": "{{X-F5-Auth-Token}}"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n    \"name\": \"{{domainname}}\",\n    \"actionsReference\": {\n        \"isSubcollection\": true,\n        \"items\": [\n            {\n                \"name\": \"0\",\n                \"fullPath\": \"0\",\n                \"code\": 0,\n                \"expirySecs\": 0,\n                \"forward\": true,\n                \"length\": 0,\n                \"offset\": 0,\n                \"pool\": \"/{{partition}}/{{name}}_{{domainname}}_pool\",\n                \"poolReference\": {\n                    \"link\": \"https://localhost/mgmt/tm/ltm/pool/~{{partition}}~{{name}}_{{domainname}}_pool\"\n                },\n                \"port\": 0,\n                \"request\": true,\n                \"select\": true,\n                \"status\": 0,\n                \"timeout\": 0,\n                \"vlanId\": 0\n            }\n        ]\n    },\n    \"conditionsReference\": {\n        \"isSubcollection\": true,\n        \"items\": [\n            {\n                \"name\": \"0\",\n                \"fullPath\": \"0\",\n                \"all\": true,\n                \"caseInsensitive\": true,\n                \"equals\": true,\n                \"external\": true,\n                \"httpHeader\": true,\n                \"index\": 0,\n                \"tmName\": \"host\",\n                \"present\": true,\n                \"remote\": true,\n                \"request\": true,\n                \"values\": [\n                    \"{{domainname}}\"\n                ]\n            }\n        ]\n    }\n}"
						},
						"url": {
							"raw": "https://{{big_ip_a_mgmt}}/mgmt/tm/ltm/policy/~{{partition}}~Drafts~{{name}}_policy/rules",
							"protocol": "https",
							"host": [
								"{{big_ip_a_mgmt}}"
							],
							"path": [
								"mgmt",
								"tm",
								"ltm",
								"policy",
								"~{{partition}}~Drafts~{{name}}_policy",
								"rules"
							]
						},
						"description": ""
					},
					"response": []
				},
				{
					"name": "Publish LTM Policy",
					"event": [
						{
							"listen": "prerequest",
							"script": {
								"type": "text/javascript",
								"exec": [
									"",
									""
								]
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							},
							{
								"key": "X-F5-Auth-Token",
								"value": "{{X-F5-Auth-Token}}"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n    \"command\": \"publish\",\n    \"name\": \"/{{partition}}/Drafts/{{name}}_policy\"\n}"
						},
						"url": {
							"raw": "https://{{big_ip_a_mgmt}}/mgmt/tm/ltm/policy",
							"protocol": "https",
							"host": [
								"{{big_ip_a_mgmt}}"
							],
							"path": [
								"mgmt",
								"tm",
								"ltm",
								"policy"
							]
						},
						"description": ""
					},
					"response": []
				}
			]
		},
		{
			"name": "Get Result",
			"description": "This Part is only included for troubleshooting and is not optimized for runner.",
			"item": [
				{
					"name": "Get Authentication Token on bigip",
					"event": [
						{
							"listen": "test",
							"script": {
								"type": "text/javascript",
								"exec": [
									"//////////////////////////////////////",
									"// Set Token",
									"",
									"var resp = JSON.parse(responseBody);",
									"postman.setGlobalVariable(\"X-F5-Auth-Token\", resp.token.token);"
								]
							}
						}
					],
					"request": {
						"auth": {
							"type": "basic",
							"basic": [
								{
									"key": "username",
									"value": "admin",
									"type": "string"
								},
								{
									"key": "password",
									"value": "admin",
									"type": "string"
								},
								{
									"key": "saveHelperData",
									"value": true,
									"type": "boolean"
								},
								{
									"key": "showPassword",
									"value": false,
									"type": "boolean"
								}
							]
						},
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							},
							{
								"key": "Authorization",
								"value": "Basic YWRtaW46YWRtaW4="
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n    \"username\":\"{{BIG-IP_username}}\",\n    \"password\":\"{{BIG-IP_password}}\",\n    \"loginProviderName\": \"tmos\"\n}"
						},
						"url": {
							"raw": "https://{{big_ip_a_mgmt}}/mgmt/shared/authn/login",
							"protocol": "https",
							"host": [
								"{{big_ip_a_mgmt}}"
							],
							"path": [
								"mgmt",
								"shared",
								"authn",
								"login"
							]
						},
						"description": ""
					},
					"response": []
				},
				{
					"name": "Get LTM Policy List",
					"event": [
						{
							"listen": "prerequest",
							"script": {
								"type": "text/javascript",
								"exec": [
									"",
									""
								]
							}
						}
					],
					"request": {
						"method": "GET",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							},
							{
								"key": "X-F5-Auth-Token",
								"value": "{{X-F5-Auth-Token}}"
							}
						],
						"body": {
							"mode": "raw",
							"raw": " {\r\n   \"skipVerifyConfig\":false,\r\n   \"skipDistribution\":false,\r\n   \"snapshotReference\":null,\r\n   \"objectsToDeployReferences\":[\r\n      {\r\n         \"link\":\"https://localhost/mgmt/cm/adc-core/working-config/ltm/pool/e80bf7e0-41ac-3056-a114-4a1b2ddc0b6c\"\r\n      }\r\n   ],\r\n   \"name\":\"add\",\r\n   \"deploySpecifiedObjectsOnly\":false,\r\n   \"deviceReferences\":[\r\n      {\r\n         \"link\":\"https://localhost/mgmt/shared/resolver/device-groups/cm-adccore-allbigipDevices/devices/00b1ece7-c700-47ab-8ce0-4bcea4b3b9e9\"\r\n      }\r\n   ]\r\n}"
						},
						"url": {
							"raw": "https://{{big_ip_a_mgmt}}/mgmt/tm/ltm/policy",
							"protocol": "https",
							"host": [
								"{{big_ip_a_mgmt}}"
							],
							"path": [
								"mgmt",
								"tm",
								"ltm",
								"policy"
							]
						},
						"description": ""
					},
					"response": []
				},
				{
					"name": "Get LTM Policy Draft",
					"event": [
						{
							"listen": "prerequest",
							"script": {
								"type": "text/javascript",
								"exec": [
									"",
									""
								]
							}
						}
					],
					"request": {
						"method": "GET",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							},
							{
								"key": "X-F5-Auth-Token",
								"value": "{{X-F5-Auth-Token}}"
							}
						],
						"body": {
							"mode": "raw",
							"raw": " {\r\n   \"skipVerifyConfig\":false,\r\n   \"skipDistribution\":false,\r\n   \"snapshotReference\":null,\r\n   \"objectsToDeployReferences\":[\r\n      {\r\n         \"link\":\"https://localhost/mgmt/cm/adc-core/working-config/ltm/pool/e80bf7e0-41ac-3056-a114-4a1b2ddc0b6c\"\r\n      }\r\n   ],\r\n   \"name\":\"add\",\r\n   \"deploySpecifiedObjectsOnly\":false,\r\n   \"deviceReferences\":[\r\n      {\r\n         \"link\":\"https://localhost/mgmt/shared/resolver/device-groups/cm-adccore-allbigipDevices/devices/00b1ece7-c700-47ab-8ce0-4bcea4b3b9e9\"\r\n      }\r\n   ]\r\n}"
						},
						"url": {
							"raw": "https://{{big_ip_a_mgmt}}/mgmt/tm/ltm/policy/~{{partition}}~Drafts~{{name}}_policy?expandSubcollections=true",
							"protocol": "https",
							"host": [
								"{{big_ip_a_mgmt}}"
							],
							"path": [
								"mgmt",
								"tm",
								"ltm",
								"policy",
								"~{{partition}}~Drafts~{{name}}_policy"
							],
							"query": [
								{
									"key": "expandSubcollections",
									"value": "true",
									"equals": true
								}
							]
						},
						"description": ""
					},
					"response": []
				},
				{
					"name": "Get LTM Policy",
					"event": [
						{
							"listen": "prerequest",
							"script": {
								"type": "text/javascript",
								"exec": [
									"",
									""
								]
							}
						}
					],
					"request": {
						"method": "GET",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							},
							{
								"key": "X-F5-Auth-Token",
								"value": "{{X-F5-Auth-Token}}"
							}
						],
						"body": {
							"mode": "raw",
							"raw": " {\r\n   \"skipVerifyConfig\":false,\r\n   \"skipDistribution\":false,\r\n   \"snapshotReference\":null,\r\n   \"objectsToDeployReferences\":[\r\n      {\r\n         \"link\":\"https://localhost/mgmt/cm/adc-core/working-config/ltm/pool/e80bf7e0-41ac-3056-a114-4a1b2ddc0b6c\"\r\n      }\r\n   ],\r\n   \"name\":\"add\",\r\n   \"deploySpecifiedObjectsOnly\":false,\r\n   \"deviceReferences\":[\r\n      {\r\n         \"link\":\"https://localhost/mgmt/shared/resolver/device-groups/cm-adccore-allbigipDevices/devices/00b1ece7-c700-47ab-8ce0-4bcea4b3b9e9\"\r\n      }\r\n   ]\r\n}"
						},
						"url": {
							"raw": "https://{{big_ip_a_mgmt}}/mgmt/tm/ltm/policy/~{{partition}}~{{name}}_policy?expandSubcollections=true",
							"protocol": "https",
							"host": [
								"{{big_ip_a_mgmt}}"
							],
							"path": [
								"mgmt",
								"tm",
								"ltm",
								"policy",
								"~{{partition}}~{{name}}_policy"
							],
							"query": [
								{
									"key": "expandSubcollections",
									"value": "true",
									"equals": true
								}
							]
						},
						"description": ""
					},
					"response": []
				}
			]
		}
	]
}